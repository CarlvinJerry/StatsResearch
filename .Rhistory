bp <- bondPrices %>%select(Code,MarketDate,MarketPrice, YieldToMaturity,CleanPrice) %>% mutate(MarketDate= lubridate::mdy(MarketDate))
library(tidyr)
install.packages("tidyr")
library(tidyr)
bp %>% complete(seq.Date(min(MarketDate), max(MarketDate), by="day"))
bp %>% as.Date(MarketDate)
bp %>% as.Date.character(MarketDate)
bp
bp
seq.Date(min(bp$MarketDate), max(bp$MarketDate), by="day")
bp %>% complete(seq.Date(min(bp$MarketDate), max(bp$MarketDate), by="day"))
bp
bp %>% complete(seq.Date(min(MarketDate), max(MarketDate), by="day"))
bp %>% complete(seq.Date(min(MarketDate), max(MarketDate), by="day"),Code,MarketPrice,YieldToMaturity,CleanPrice)
bp %>% complete(MarketDate=seq.Date(min(MarketDate), max(MarketDate), by="day"),Code,MarketPrice,YieldToMaturity,CleanPrice)
bp <- bp %>% complete(MarketDate=seq.Date(min(MarketDate), max(MarketDate), by="day"),Code,MarketPrice,YieldToMaturity,CleanPrice)
View(bp)
bondPrices <- read_csv("bondPrices.csv")
bp <- bondPrices %>%select(Code,MarketDate,MarketPrice, YieldToMaturity,CleanPrice) %>% mutate(MarketDate= lubridate::mdy(MarketDate))
bp
bp %>% complete(MarketDate=seq.POSIXt(min(MarketDate), max(MarketDate), by="day"),Code,MarketPrice,YieldToMaturity,CleanPrice)
bp %>% as.Date(MarketDate)
bp %>% as.Date(MarketDate, format="%Y-%m-%d")
bp %>% as.Date(bp$MarketDate, format="%Y-%m-%d")
bp <- bondPrices %>%select(Code,MarketDate,MarketPrice, YieldToMaturity,CleanPrice) %>% mutate(MarketDate= lubridate::mdy(MarketDate))
bp
bp %>% complete(MarketDate=seq.Date(min(MarketDate), max(MarketDate), by="day"),Code,MarketPrice,YieldToMaturity,CleanPrice)
knitr::opts_chunk$set(echo = TRUE)
variance <- 4
std.dev <- 2
std.dev = 2* degrees of freedom
variance <- 4
std.dev <- 2
##std.dev = 2* degrees of freedom
degres_of_freedom = std.dev/2
pchisq(1,degres_of_freedom)
# P(1.5 < x < 3) = P(x < 3) - P(x < 1.5)
pchisq(3,2) - pchisq(1.5,2)
dlnorm(1,meanlog=0, sdlog=1)
plnorm(3,0,1) - plnorm(1.5,0,1)
VitaminData = c(17,25,17,33,24,15,18,19,14,23,19,23,25,27,21,26,20)
sd(VitaminData)
sv  <- sd(VitaminData)/sqrt(length(VitaminData))
VitaminData = c(17,25,17,33,24,15,18,19,14,23,19,23,25,27,21,26,20)
sd(VitaminData)
sv  <- sd(VitaminData)/sqrt(length(VitaminData))
VitaminData = c(17,25,17,33,24,15,18,19,14,23,19,23,25,27,21,26,20)
sd(VitaminData)
sv  <- sd(VitaminData)/sqrt(length(VitaminData))
sv
getwd()
library(readr)
lassoData <- read_csv("LassoRR_sysm590_4K5K70pct.csv")
library(readr)
lassoData <- read_csv("LassoRR_sysm590_4K5K70pct.csv")
##colnames(lassoData)
cor(lassoData)
##Evidence of multicoliniarity given the high correlation among the x variables
regresults <-  lm(Y ~ . ,lassoData)
summary(regresults)
##Ridge regression
#Automatically does the ridge regression selecting the best lambda parameter
library(ridge)
mod<-linearRidge(Y ~.,data=lassoData,lambda="automatic");
summary(mod)
plumber::plumb(file='testplumber/plumber.R')$run()
plumb(file='testplumber/plumber.R')$run()
division <- function(input1,input2)
{
result = input1/input2
}
division()
division(10,2)
division <- function(input1,input2)
{
result = input1/input2
}
division(10,2)
division(10,Mishel)
Mishel <- 2
Mishel
division(10,Mishel)
result
division <- function(input1,input2)
{
result = input1/input2
result
}
Mishel <- 2
division(10,Mishel)
division <- function(input1,input2)
{input1/input2
}
Mishel <- 2
division(10,Mishel)
10/5
10/2
Mishel<-3
Mishel
division(10,Mishel)
Mishel<-"Mkayika"
Mishel
division(10,Mishel)
plumber::plumb(file='testplumber/plumber.R')$run()
plumb(file='testplumber/plumber.R')$run()
plumb(file='testplumber/plumber.R')$run()
10+10
library(forecast)
install.packages("forecast")
library(forecast)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stargazer)
install.packages(stargazer)
install.packages("stargazer")
library(forecast)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stargazer)
library(ggplot2)
library(data.table)
library(tableone)
install.packages("tableone")
library(forecast)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stargazer)
library(ggplot2)
library(data.table)
library(tableone)
library(lattice)
library(pwr)
install.packages("pwr")
library(forecast)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stargazer)
library(ggplot2)
library(data.table)
library(tableone)
library(lattice)
library(pwr)
library(rcompanion)
install.packages("rcompendium")
install.packages("rcompendium")
install.packages("rcompanion")
library(forecast)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stargazer)
library(ggplot2)
library(data.table)
library(tableone)
library(lattice)
library(pwr)
#library(rcompanion)
library(scales)
library(plm)
install.packages("plm")
library(forecast)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stargazer)
library(ggplot2)
library(data.table)
library(tableone)
library(lattice)
library(pwr)
#library(rcompanion)
library(scales)
library(plm)
library(readxl)
install.packages("readxl")
library(forecast)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stargazer)
library(ggplot2)
library(data.table)
library(tableone)
library(lattice)
library(pwr)
#library(rcompanion)
library(scales)
library(plm)
library(readxl)
library(MatchIt)
install.packages("MatchIt")
install.packages("lfe")
install.packages("synth")
Y
install.packages("Synth")
install.packages("gsynth")
install.packages("panelview")
install.packages("panelView")
install.packages("causalImpact")
install.packages("CausalImpact")
library(forecast)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stargazer)
library(ggplot2)
library(data.table)
library(tableone)
library(lattice)
library(pwr)
#library(rcompanion)
library(scales)
library(plm)
library(readxl)
library(MatchIt)
library(lfe)
library(Synth)
library(gsynth)
library(panelView)
library(CausalImpact)
library(knitr)
data(basque)
basque
unused <- c("sec.agriculture", "sec.energy" , "sec.industry" , "sec.construction" ,
"sec.services.venta" , "sec.services.nonventa", "school.illit", "school.prim",
"school.med", "school.high", "school.post.high", "popdens")
basq_clean <- basque[,!(names(basque) %in% unused)]
basq_clean <- basq_clean %>%
mutate(post = ifelse(year > 1975, 1, 0),
treat = ifelse(regionname == "Basque Country (Pais Vasco)", 1, 0),
regionname = as.factor(regionname)) %>%
filter(regionno != 1)
# Calculating first differences
basq_fdid <- basq_clean %>%
filter(treat == 1)
ggplot(basq_fdid, aes(x=year, y=gdpcap)) +
geom_line(color = "#F8766D") + theme_classic() +
geom_vline(xintercept=1975, color = "steelblue", linetype = "dashed") +
labs(title="GDP trend over years for Basque",
y="GDP per capita",x="Years", color = "Region") +
annotate("text", x = 1970, y = 9, label = "Pre-period", size  =5, color = "steelblue") +
annotate("text", x = 1980, y = 9, label = "Post-period", size  =5, color = "steelblue")
# Calculating first differences
f_did <- lm(data = basq_fdid, gdpcap ~ post)
stargazer(f_did, type="text")
#Picking the closest control group based on gdp
pre <- basq_clean %>%
filter(post == 0) %>%
left_join(dplyr::select(basq_clean[basq_clean$post==0 & basq_clean$treat == 1, ], gdpcap, year),
by = c("year"= 'year')) %>%
mutate(perc_diff = (gdpcap.y - gdpcap.x) / gdpcap.y) %>%
group_by(regionname) %>%
summarise(gdp_var = abs(var(perc_diff))) %>%
arrange(gdp_var)
# Validating assumption
did_data <- basq_clean %>%
filter(regionname %in% c("Basque Country (Pais Vasco)", "Cataluna"))
ggplot(did_data, aes(x=year, y=gdpcap, group = regionname)) +
geom_line(aes(color = regionname)) +
theme_classic() +
geom_vline(xintercept=1975, color = "steelblue", linetype = "dashed") +
labs(title="GDP trend over years for different regions",
y="GDP per capita",x="Years", color = "Region") +
scale_color_manual(labels = c("Basque (treated)", "Cataluna (control)"), values = c("#00BFC4", "#F8766D"))
# Difference in differences
did <- lm(data = did_data, gdpcap ~ treat*post)
stargazer(did, type="text")
# Causal Impact
basq_CI <- basq_clean %>%
filter(regionname %in% c("Basque Country (Pais Vasco)", "Cataluna")) %>%
mutate(date = as.Date(paste0(year, "-01", "-01"), format = "%Y-%m-%d")) %>%
dplyr::select(date, regionname, gdpcap) %>%
spread(regionname, gdpcap)
names(basq_CI) <- c("date", "Basque", "another")
pre.period <- as.Date(c("1955-01-01", "1975-01-01"))
post.period <- as.Date(c("1976-01-01", "1997-01-01"))
impact <- CausalImpact(basq_CI, pre.period, post.period)
summary(impact)
basq_synth <- basq_clean %>%
rename(Y = gdpcap) %>%
mutate(regionname = as.character(regionname))
ggplot(basq_synth, aes(x=year,y=Y,group=regionno)) +
geom_line(aes(color=as.factor(treat), size=as.factor(treat))) +
geom_vline(xintercept=1975,linetype="dashed", color = "steelblue") + theme_classic() +
labs(title="GDP trend over years for all regions",
y="GDP per capita",x="Years", color = "Treatment group") +
scale_color_manual(labels = c("Control", "Treated"), values = c("#F8766D", "#00BFC4")) +
scale_size_manual(values = c(0.5,1.5), guide = 'none')
# synth
dataprep.out <-
dataprep(
foo = basque
,predictors= c("school.illit",
"school.prim",
"school.med",
"school.high",
"school.post.high"
,"invest"
)
,predictors.op = c("mean")
,dependent     = c("gdpcap")
,unit.variable = c("regionno")
,time.variable = c("year")
,special.predictors = list(
list("gdpcap",1960:1969,c("mean")),
list("sec.agriculture",seq(1961,1969,2),c("mean")),
list("sec.energy",seq(1961,1969,2),c("mean")),
list("sec.industry",seq(1961,1969,2),c("mean")),
list("sec.construction",seq(1961,1969,2),c("mean")),
list("sec.services.venta",seq(1961,1969,2),c("mean")),
list("sec.services.nonventa",seq(1961,1969,2),c("mean")),
list("popdens",1969,c("mean")))
,treatment.identifier  = 17
,controls.identifier   = c(2:16,18)
,time.predictors.prior = c(1964:1969)
,time.optimize.ssr     = c(1960:1969)
,unit.names.variable   = c("regionname")
,time.plot            = c(1955:1997)
)
synth.out = synth(dataprep.out)
# Two native plotting functions.
# Path.plot() plots the synthetic against the actual treated unit data.
path.plot(dataprep.res = dataprep.out, synth.res = synth.out,Xlab="Year",Ylab="GDP Per Capita")
abline(v=1975,lty=2,col="steelblue")
title("Actual vs Synthetic GDP for Basque")
# Gaps.plot() shows the deviation between the synthetic and the actual over time.
#gaps.plot(dataprep.res = dataprep.out, synth.res = synth.out,Xlab="Year",Ylab="Diff in GDP Per Capita")
#abline(v=1975,lty=2,col="red")
# Calculating root mean squared error between actual and synthetic
round(sqrt(mean((dataprep.out$Y1plot - (dataprep.out$Y0plot %*% synth.out$solution.w))^2)), 2)
labels <- c("DiD", "Causal Impact", "Synthetic Control")
values <- c(-0.85, -0.76, -0.57)
values_df <- data.frame(labels,values)
names(values_df) <- c("Method", "Change in GDP per captia")
kable(values_df)
getwd()
plot(cars)
library(forecast)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stargazer)
library(ggplot2)
library(data.table)
library(tableone)
library(lattice)
library(pwr)
#library(rcompanion)
library(scales)
library(plm)
library(readxl)
library(MatchIt)
library(lfe)
library(Synth)
library(gsynth)
library(panelView)
library(CausalImpact)
library(knitr)
data(basque)
data(basque)
head(basque,10)
data(basque)
head(basque,10)
colnames(basque)
unused <- c("sec.agriculture", "sec.energy" , "sec.industry" , "sec.construction" ,
"sec.services.venta" , "sec.services.nonventa", "school.illit", "school.prim",
"school.med", "school.high", "school.post.high", "popdens")
basq_clean <- basque[,!(names(basque) %in% unused)]
basq_clean <- basq_clean %>%
mutate(post = ifelse(year > 1975, 1, 0),
treat = ifelse(regionname == "Basque Country (Pais Vasco)", 1, 0),
regionname = as.factor(regionname)) %>%
filter(regionno != 1)
unused <- c("sec.agriculture", "sec.energy" , "sec.industry" , "sec.construction" ,
"sec.services.venta" , "sec.services.nonventa", "school.illit", "school.prim",
"school.med", "school.high", "school.post.high", "popdens")
basq_clean <- basque[,!(names(basque) %in% unused)]
basq_clean <- basq_clean %>%
mutate(post = ifelse(year > 1975, 1, 0),
treat = ifelse(regionname == "Basque Country (Pais Vasco)", 1, 0),
regionname = as.factor(regionname)) %>%
filter(regionno != 1)
head(basq_clean)
# Calculating first differences
basq_fdid <- basq_clean %>%
filter(treat == 1)
ggplot(basq_fdid, aes(x=year, y=gdpcap)) +
geom_line(color = "#F8766D") + theme_classic() +
geom_vline(xintercept=1975, color = "steelblue", linetype = "dashed") +
labs(title="GDP trend over years for Basque",
y="GDP per capita",x="Years", color = "Region") +
annotate("text", x = 1970, y = 9, label = "Pre-period", size  =5, color = "steelblue") +
annotate("text", x = 1980, y = 9, label = "Post-period", size  =5, color = "steelblue")
# Calculating first differences
basq_fdid <- basq_clean %>%
filter(treat == 1)
ggplot(basq_fdid, aes(x=year, y=gdpcap)) +
geom_line(color = "#F8766D") + theme_classic() +
geom_vline(xintercept=1975, color = "steelblue", linetype = "dashed") +
labs(title="GDP trend over years for Basque",
y="GDP per capita",x="Years", color = "Region") +
annotate("text", x = 1970, y = 9, label = "Pre-period", size  =5, color = "steelblue") +
annotate("text", x = 1980, y = 9, label = "Post-period", size  =5, color = "steelblue")
# Calculating first differences
basq_fdid <- basq_clean %>%
filter(treat == 1)
ggplot(basq_fdid, aes(x=year, y=gdpcap)) +
geom_line(color = "#F8766D") + theme_classic() +
geom_vline(xintercept=1975, color = "steelblue", linetype = "dashed") +
labs(title="GDP trend over years for Basque",
y="GDP per capita",x="Years", color = "Region") +
annotate("text", x = 1970, y = 9, label = "Pre-period", size  =5, color = "steelblue") +
annotate("text", x = 1980, y = 9, label = "Post-period", size  =5, color = "steelblue")
# Calculating first differences
f_did <- lm(data = basq_fdid, gdpcap ~ post)
stargazer(f_did, type="text")
#Picking the closest control group based on gdp
pre <- basq_clean %>%
filter(post == 0) %>%
left_join(dplyr::select(basq_clean[basq_clean$post==0 & basq_clean$treat == 1, ], gdpcap, year),
by = c("year"= 'year')) %>%
mutate(perc_diff = (gdpcap.y - gdpcap.x) / gdpcap.y) %>%
group_by(regionname) %>%
summarise(gdp_var = abs(var(perc_diff))) %>%
arrange(gdp_var)
# Validating assumption
did_data <- basq_clean %>%
filter(regionname %in% c("Basque Country (Pais Vasco)", "Cataluna"))
ggplot(did_data, aes(x=year, y=gdpcap, group = regionname)) +
geom_line(aes(color = regionname)) +
theme_classic() +
geom_vline(xintercept=1975, color = "steelblue", linetype = "dashed") +
labs(title="GDP trend over years for different regions",
y="GDP per capita",x="Years", color = "Region") +
scale_color_manual(labels = c("Basque (treated)", "Cataluna (control)"), values = c("#00BFC4", "#F8766D"))
# Difference in differences
did <- lm(data = did_data, gdpcap ~ treat*post)
stargazer(did, type="text")
system.date()
getwd()
library(forecast)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stargazer)
library(ggplot2)
library(data.table)
library(tableone)
library(lattice)
library(pwr)
#library(rcompanion)
library(scales)
library(plm)
library(readxl)
library(MatchIt)
library(lfe)
library(Synth)
library(gsynth)
library(panelView)
library(CausalImpact)
library(knitr)
# synth
dataprep.out <-
dataprep(
foo = basque
,predictors= c("school.illit",
"school.prim",
"school.med",
"school.high",
"school.post.high"
,"invest"
)
,predictors.op = c("mean")
,dependent     = c("gdpcap")
,unit.variable = c("regionno")
,time.variable = c("year")
,special.predictors = list(
list("gdpcap",1960:1969,c("mean")),
list("sec.agriculture",seq(1961,1969,2),c("mean")),
list("sec.energy",seq(1961,1969,2),c("mean")),
list("sec.industry",seq(1961,1969,2),c("mean")),
list("sec.construction",seq(1961,1969,2),c("mean")),
list("sec.services.venta",seq(1961,1969,2),c("mean")),
list("sec.services.nonventa",seq(1961,1969,2),c("mean")),
list("popdens",1969,c("mean")))
,treatment.identifier  = 17
,controls.identifier   = c(2:16,18)
,time.predictors.prior = c(1964:1969)
,time.optimize.ssr     = c(1960:1969)
,unit.names.variable   = c("regionname")
,time.plot            = c(1955:1997)
)
synth.out = synth(dataprep.out)
# Two native plotting functions.
# Path.plot() plots the synthetic against the actual treated unit data.
path.plot(dataprep.res = dataprep.out, synth.res = synth.out,Xlab="Year",Ylab="GDP Per Capita")
abline(v=1975,lty=2,col="steelblue")
title("Actual vs Synthetic GDP for Basque")
# Gaps.plot() shows the deviation between the synthetic and the actual over time.
#gaps.plot(dataprep.res = dataprep.out, synth.res = synth.out,Xlab="Year",Ylab="Diff in GDP Per Capita")
#abline(v=1975,lty=2,col="red")
# Calculating root mean squared error between actual and synthetic
round(sqrt(mean((dataprep.out$Y1plot - (dataprep.out$Y0plot %*% synth.out$solution.w))^2)), 2)
labels <- c("DiD", "Causal Impact", "Synthetic Control")
values <- c(-0.85, -0.76, -0.57)
values_df <- data.frame(labels,values)
names(values_df) <- c("Method", "Change in GDP per captia")
kable(values_df)
